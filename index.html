<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2" />
    <link rel="manifest" href="/manifest.json">
    <title>Cell-S-Dial</title>
  </head>
  <body>

    <!-- TODO: for the time of using live-server for quick feedback it is more useful to keep the code inline.
    extract later -->
    <!-- <script src="game_logic.js"></script> -->
    <script>
      const SPRITE_WIDTH = 32;
      const SPRITE_HEIGHT = 32;
      const SCALE = 1;
      const FPS = 26;
      canvas = document.createElement('canvas');
      canvas.width = SPRITE_WIDTH * SCALE;
      canvas.height = SPRITE_HEIGHT * SCALE;
      document.body.appendChild(this.canvas);

      this.context = this.canvas.getContext('2d');
      this.context.imageSmoothingEnabled = false;
      this.context.scale(SCALE, SCALE);

      class SpriteFrameLocation
      {
        constructor(x, y, spriteWidth, spriteHeight)
        {
          this.x = x;
          this.y = y;
          this.spriteWidth = spriteWidth;
          this.spriteHeight = spriteHeight;
        }
      }

      var bullet = {
        x: 0,
        y: 0,
      }

      var player = 
      {
        x: 100,
        y: 100,
        left: false,
        up: false,
        right: false,
        down: false,
        fire: false,
        speed: 10,
        frame: 0,
        frameIndex: 0,
        getSpriteSheet: function ()
          {
            let image = new Image();
            image.src = "Assets/Player_Ship_1.png";
            image.crossOrigin = true;
            return image;
          },
          currentSprite: 0,
          <!-- TODO: later on extract generic method for getting spritesheet along with each sprite coords -->
          flightCycle: [
            new SpriteFrameLocation
              (
                0 * SPRITE_WIDTH,
                0 * SPRITE_HEIGHT,
                SPRITE_WIDTH,
                SPRITE_HEIGHT
              ),
            new SpriteFrameLocation
              (
                0 * SPRITE_WIDTH,
                1 * SPRITE_HEIGHT,
                SPRITE_WIDTH,
                SPRITE_HEIGHT
              ),
          ]
      };

      function animate()
      {
        if(player.frameIndex == player.flightCycle.length)
        {
          player.frameIndex = 0;
        }
        player.frame = player.flightCycle[player.frameIndex];
        context.clearRect(
          0,
          0,
          canvas.width,
          canvas.height
        );
        context.drawImage(
          player.getSpriteSheet(),
          player.frame.x,
          player.frame.y,
          player.frame.spriteWidth,
          player.frame.spriteHeight,
          0,
          0,
          player.frame.spriteWidth,
          player.frame.spriteHeight,
        );
        player.frameIndex += 1;
      }

      window.onload = function()
      {
        document.addEventListener("keydown", keydown);
        document.addEventListener("keyup", keyup);
        setInterval(gameloop, 1000 / FPS);
      }

      function gameloop()
      {
          gamelogic();
          paintScreen();
          animate();
      }

      function intersectRect(r1l, r1u, r1r, r1d, r2l, r2u, r2r, r2d)
      {
          return !(r2l > r1r || r2r < r1l || r2u > r1d || r2d < r1u)
      }

      function gamelogic()
      {
          if(player.left)
          {
            player.x -= player.speed;
          }
          if(player.right)
          {
            player.x += player.speed;
          }
          if(player.up)
          {
            player.y -= player.speed;
          }
          if(player.down)
          {
            player.y += player.speed;
          }
      }

      function keydown(event)
      {
          console.log(event.keyCode)
          switch(event.keyCode)
          {
              case 37: player.left = true; break;
              case 38: player.up = true; break;
              case 39: player.right = true; break;
              case 40: player.down = true; break;
              case 90: player.fire = true; break;
          }
      }

      function keyup(event)
      {
          switch(event.keyCode)
          {
              case 37: player.left = false; break;
              case 38: player.up = false; break;
              case 39: player.right = false; break;
              case 40: player.down = false; break;
              case 90: player.fire = false; break;
          }
      }

      
      function paintScreen()
      {
        context.fillStyle = "#000";
        context.fillRect(0, 0, canvas.width, canvas.height);
      }
    </script>
    
    <script>
      if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js', { scope: '/' });
      }
    </script>

  </body>
</html>